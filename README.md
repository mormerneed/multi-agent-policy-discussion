# 🎯 多智能体政策讨论可视化系统

基于MetaGPT框架的智能政策制定与讨论系统，通过多个专业角色的协作讨论，实现政策的科学制定和优化。

## ✨ 系统特色

### 🤖 多智能体协作
- **7个专业角色**：政策制定者、经济专家、环境专家、法规专家、制造专家、物流专家、基建专家
- **智能权重分配**：不同角色具有不同的决策权重，确保专业性
- **动态共识机制**：自动检测讨论共识，智能决定讨论轮次

### 🎨 实时可视化界面
- **现代化UI设计**：基于Tailwind CSS和Alpine.js的响应式界面
- **实时消息流**：Server-Sent Events技术实现毫秒级更新
- **智能内容解析**：自动提取评分、建议、问题等结构化信息
- **多维度筛选**：支持按角色、轮次筛选查看讨论内容

### 📊 智能分析功能
- **轮次追踪**：清晰显示讨论进展（1-10轮）
- **评分系统**：1-10分评价体系，颜色编码直观展示
- **统计分析**：角色活跃度、平均评分、同意度分析
- **政策演进**：追踪政策修订历史和变化

## 🚀 快速开始

### 环境要求
```bash
# Python 3.8+
# Anaconda/Miniconda

# 创建虚拟环境
conda create -n metagpt python=3.9
conda activate metagpt

# 安装依赖
pip install -r requirements.txt
```

### 配置设置
1. 复制配置文件：
```bash
cp config/config.yaml.example config/config.yaml
```

2. 配置API密钥（在 `config/config.yaml` 中）：
```yaml
llm:
  api_type: "zhipuai"  # 或其他支持的LLM
  api_key: "your-api-key-here"
  model: "glm-4"
```

### 启动系统

# 🎉 多智能体政策讨论系统 - 增强版

## ✨ 全新功能

您要求的功能已经完全实现！现在您可以**直接在Web界面上点击按钮启动政策讨论**，无需手动在命令行运行。

### 🚀 新增功能特性

#### 1. **Web界面启动讨论**
- 🎯 点击右上角"启动讨论"按钮
- 📝 在弹出对话框中输入政策议题
- ⚡ 一键启动后台讨论进程

#### 2. **实时状态监控**
- 🟠 讨论进行中：橙色指示灯闪烁
- 🟢 等待中：绿色指示灯
- 📊 实时显示讨论进度

#### 3. **讨论控制**
- ▶️ **启动按钮**：开始新的政策讨论
- ⏹️ **停止按钮**：中断当前讨论
- 📈 **进度提示**：右下角显示当前状态

#### 4. **实时同步显示**
- 💬 专家发言实时推送到界面
- 📊 统计数据自动更新
- 🔄 无需刷新页面

## 🎯 使用方法

### 步骤1：启动服务器
```bash
# 确保在metagpt环境中
conda activate metagpt

# 启动增强版服务器
python web_server_new.py
```

### 步骤2：访问Web界面
- 浏览器会自动打开 http://localhost:5000
- 或手动访问该地址

### 步骤3：启动讨论
1. **点击"启动讨论"按钮**（右上角蓝色按钮）
2. **输入讨论主题**，例如：
   ```
   建立分层低空空域区域与动态无人机交通管理系统，支持商业无人机运营
   ```
3. **点击"开始讨论"**
4. **观察实时讨论**：
   - 左侧显示各角色统计更新
   - 右侧显示专家发言实时推送
   - 右下角显示讨论进度

### 步骤4：监控讨论过程
- ✅ **状态指示**：橙色闪烁表示讨论进行中
- 📝 **实时消息**：专家发言自动出现
- 📊 **统计更新**：角色发言数和评分实时更新
- 🛑 **随时停止**：点击红色"停止"按钮

## 🔧 技术实现

### 后端API
- **`POST /api/start_discussion`**：启动讨论
- **`POST /api/stop_discussion`**：停止讨论
- **`GET /api/discussion_status`**：获取讨论状态
- **`GET /api/messages/stream`**：实时消息流

### 前端功能
- **Alpine.js**：响应式状态管理
- **Server-Sent Events**：实时消息推送
- **状态轮询**：每5秒检查讨论状态
- **用户交互**：对话框、按钮、通知

### 后台进程
- **subprocess**：启动main.py进程
- **threading**：异步处理讨论
- **实时监控**：进程状态跟踪

## 🎨 界面改进

### 顶部导航栏
```
多智能体政策讨论系统    [🟠讨论进行中] [▶️启动讨论] [⏹️停止] [🟢实时连接] [⏰时间]
```

### 讨论对话框
```
┌─────────────────────────────────┐
│ 启动新的政策讨论                 │
├─────────────────────────────────┤
│ 讨论主题                        │
│ ┌─────────────────────────────┐ │
│ │ 输入您的政策议题...         │ │
│ └─────────────────────────────┘ │
│                                 │
│ ℹ️ 讨论将在后台运行，您可以在    │
│   此界面实时观察各专家的发言     │
│                                 │
│              [取消] [开始讨论]   │
└─────────────────────────────────┘
```

### 进度提示
```
右下角浮动：[🔄] 正在启动讨论...
           [🔄] 讨论进行中...
           [✅] 讨论已完成
```

## 📊 实时数据同步

### 消息推送流程
1. **后台讨论**：main.py运行政策讨论
2. **日志写入**：专家发言写入logs/文件
3. **实时解析**：Web服务器监控日志变化
4. **消息推送**：通过SSE推送到前端
5. **界面更新**：前端实时显示新消息

### 状态同步
- **每5秒轮询**：检查讨论进程状态
- **实时指示**：更新状态指示灯
- **进度显示**：显示当前讨论阶段

## 🎯 完整的用户体验

现在您可以：

1. **🌐 打开Web界面** - 一个地址搞定所有功能
2. **🎯 点击启动按钮** - 无需命令行操作
3. **📝 输入讨论主题** - 直观的对话框界面
4. **⚡ 实时观察讨论** - 专家发言同步显示
5. **📊 监控讨论进度** - 状态指示和统计更新
6. **🛑 随时停止讨论** - 完全的控制权

## 🚀 立即体验

```bash
# 启动增强版系统
conda activate metagpt
python start_enhanced_server.py
```

访问 http://localhost:5001，点击"启动讨论"按钮，输入您的政策议题，开始体验全新的Web界面政策讨论功能！