#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
æµ‹è¯•æ”¿ç­–ä¿®è®¢å†å²åŠŸèƒ½
"""

import webbrowser
import time
import subprocess
import sys
from pathlib import Path

def main():
    print("ğŸ“œ å¯åŠ¨æ”¿ç­–ä¿®è®¢å†å²æµ‹è¯•")
    print("=" * 50)
    
    # å¯åŠ¨webæœåŠ¡å™¨
    print("ğŸ“¡ å¯åŠ¨WebæœåŠ¡å™¨...")
    try:
        server_process = subprocess.Popen([
            sys.executable, "web_server_new.py"
        ], cwd=Path(__file__).parent)
        
        # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨
        print("â³ ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨...")
        time.sleep(3)
        
        # æ‰“å¼€æµè§ˆå™¨åˆ°ä¸åŒé¡µé¢
        print("ğŸŒ æ‰“å¼€æµè§ˆå™¨...")
        
        # ä¸»è®¨è®ºé¢æ¿
        webbrowser.open("http://127.0.0.1:5001/")
        time.sleep(1)
        
        # æ”¿ç­–ä¿®è®¢å†å²
        webbrowser.open("http://127.0.0.1:5001/history")
        time.sleep(1)
        
        print("âœ… æµ‹è¯•ç¯å¢ƒå·²å¯åŠ¨ï¼")
        print("\nğŸ“‹ åŠŸèƒ½æµ‹è¯•æ¸…å•:")
        print("1. ğŸ  ä¸»é¢æ¿ (http://127.0.0.1:5001/)")
        print("   - å¯åŠ¨ä¸€ä¸ªæ”¿ç­–è®¨è®º")
        print("   - è§‚å¯Ÿä¸“å®¶ä»¬çš„è®¨è®ºè¿‡ç¨‹")
        print("")
        print("2. ğŸ“œ ä¿®è®¢å†å² (http://127.0.0.1:5001/history)")
        print("   - æŸ¥çœ‹æ”¿ç­–ç‰ˆæœ¬çš„æ—¶é—´çº¿")
        print("   - å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æ”¿ç­–å†…å®¹")
        print("   - æŸ¥çœ‹æ¯æ¬¡ä¿®æ”¹çš„å…·ä½“å˜æ›´")
        print("   - âœ¨ æ–°åŠŸèƒ½ï¼šæŸ¥çœ‹ä¿ƒæˆä¿®æ”¹çš„ä¸“å®¶å»ºè®®")
        print("   - æµ‹è¯•ä¸‰ç§è§†å›¾æ¨¡å¼:")
        print("     â€¢ æ—¶é—´çº¿è§†å›¾ - çœ‹åˆ°æ”¿ç­–æ¼”è¿›è¿‡ç¨‹å’Œä¸“å®¶å»ºè®®")
        print("     â€¢ å¯¹æ¯”è§†å›¾ - è¯¦ç»†å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬")
        print("     â€¢ å˜æ›´åˆ—è¡¨ - æŸ¥çœ‹æ‰€æœ‰ä¿®æ”¹è®°å½•")
        print("")
        print("ğŸ¯ é‡ç‚¹æµ‹è¯• - ä¸“å®¶å»ºè®®è¿½è¸ª:")
        print("â€¢ å¯åŠ¨è®¨è®ºåï¼Œè§‚å¯Ÿä¸“å®¶å»ºè®®å¦‚ä½•å½±å“æ”¿ç­–ä¿®è®¢")
        print("â€¢ æŸ¥çœ‹æ¯ä¸ªæ”¿ç­–ç‰ˆæœ¬ä¸‹æ–¹çš„'ä¿ƒæˆä¿®æ”¹çš„ä¸“å®¶å»ºè®®'éƒ¨åˆ†")
        print("â€¢ è§‚å¯Ÿå»ºè®®ä¸ä¿®æ”¹ä¹‹é—´çš„å…³è”æ€§å’Œç›¸å…³åº¦è¯„åˆ†")
        print("â€¢ æŸ¥çœ‹åŒ¹é…çš„å…³é”®è¯å’Œå»ºè®®åˆ†ç±»")
        print("â€¢ æµ‹è¯•ä¸“å®¶å»ºè®®çš„å®æ—¶æ›´æ–°å’Œç»Ÿè®¡")
        print("")
        print("æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨")
        
        # ä¿æŒè¿è¡Œ
        server_process.wait()
        
    except KeyboardInterrupt:
        print("\nğŸ›‘ åœæ­¢æœåŠ¡å™¨...")
        server_process.terminate()
        server_process.wait()
        print("âœ… æœåŠ¡å™¨å·²åœæ­¢")
    except Exception as e:
        print(f"âŒ å¯åŠ¨å¤±è´¥: {e}")

if __name__ == "__main__":
    main()
